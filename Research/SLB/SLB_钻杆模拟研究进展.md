### 研究进展_钻杆模拟研究进展

> Copyright ZhenLiu



#### **230313 ** 回顾fsolve和fixpoint的代码实现

- Matlab代码命名规范：
  - using only lowercase to name function  <mainonlylinear>
  - using only uppercase to name constant <E>
  - using first letter lower and after upper of the first letter of word to name variable <horizontalForce>
  - using first letter upper to name struct <Para>
- 关于代码的一些注释：
  - 关于命名的注释
    - 求解方法  K(U)U=F(U)
      - Fixppoint - using fixpoint point iteration to calculate nonlinear problem, so we need subfunction to help us to calculate $U_{k} =  K(U_{k-1})^{-1}F(U_{k-1})$,so we need 
        -  **fixpoint_myfun_contact** to calculate Global stiffness and Global force to get the displacement 
        -  **Main_fixpoint** to run the fix point iteration method.
      - Fsolve - using fsolve funciton to calculate nonlinear problem, so we need subfunction to help us find the solution of $F(U)=0$
        - **fsolve_myfun_contact** to give the expression of F(U);
        - **Main_fsolve** to run the fsolve method to get the solution.
- 下一步的计划和目标：
  - 了解Robin提供的数值算例，单位换算，产生对比的实现；
  - 了解师兄关于摩擦部分的代码实现，method方法具体的含义？；
  - 实现吴老师提供的摩擦问题的解决办法，看成是方程的右端项进行实现？



#### **230316** 接触部分模型代码的回顾

- 完成初步的代码测试函数文件
  - fixpoint 求解线性模型下的接触问题和摩擦问题；
  - fsolve    求解完全非线性模型下的接触问题和摩擦问题；
- 学习Robin提供的数值算例，并完成fsolve相关的数值算例，完成对应的PPT=MatlabCode_Review
- **Fix** 解决利用fsolve求解接触模型得到的变形并不是完全对称的：
  - 追踪220625版本，检查此版本代码，利用fsolve计算完全非线性模型的接触问题3D模型是否能得到对称的变形，以此作为baseline来检测代码是否发生意外的变换；
  - 当torque=0的时候，得到的接触变形是**完全对称**的，此时只是发生$xz$平面的变形；
  - ❓当torque>0的时候，由于此时杆件在$y$方向发生变形，因此得到的变形不对称是正常的！
- 复习220625代码的逻辑框架：
  - 接触模型的3D模型： 是指允许发生3维空间中的变形，即$U_{y}\neq0$，此时利用$r>=g$的时候发生接触；
  - 接触模型的2D模型： 是指允许发生2维空间中的变形，即$U_{y}=0$，此时利用$u_{z}>=g$的时候发生接触；
  - 接触模型中的两个刚度矩阵模型选择：完全非线性模型，部分非线性模型；
  - 接触模型中的两个接触力模型选择：作为刚度矩阵项组装在左侧，作为接触力项组装在右侧；
  - 注意⚠️：在23年的版本中，关于接触模型全部选择3D+完全非线性+接触力项组装在右侧的结果；
- 复习关于函数绘图:
  - Uplot，提供绘制$Uy,Uz$的函数变形；
  - Uplotter，提供绘制子窗口图形，各个单独变形，以及比较变形的功能，但是需要先进行**初始化**；
- 复习单位换算：
  - 长度单位1英尺feet约等于1/3米，也就是30厘米；
  - 长度单位1英寸inch约等于1/40米，也就是2.5厘米；
  - 长度单位1英尺等于12英寸，上述估计是粗略的，但是这个关系是精确的；
  - 力单位1磅推力libraforce约等于4.5N，也就是 1 lbf = 4.5 N；
  - 角速度单位 1 RPM = 1 rev/min = 2π rad/ 60 s ，因此钻杆表面的速度只需再乘以钻杆的半径；



#### **230317** 修改接触部分代码的结构

- 复习Python代码（FeDomain）

  - calculate_contact_force3d	

    - 与Matlab对应名称代码的功能一致；

    - ⚠️发现接触力的刚度矩阵项可以作为力施加在右侧！！！

    - ⚠️发现接触力的刚度矩阵和右端项合起来正好是计算接触力的公式！！！

    - 计算接触力的右端项：
      $$
      L \int_0^1 H\left(r(\xi)^2-g^2\right) \frac{g u_{y 0}(\xi)}{r(\xi)} \delta u_{y 0}(\xi) d \xi
      $$

  - calculate_contact_force3d_3

    - 计算完整的接触力，实际上接触力的计算方法如下，根据分布力转换成节点力的方法，要计算y方向的接触力，首先应该得到y方向的分布意义下的接触力，然后乘以对应的形函数即使转换完成之后的节点力，$K_w(r(x)-g) \frac{u_{y 0}(x)}{r(x)}$是y方向分布意义下的接触力。

    - 接触力的计算公式：
      $$
      \int_0^L H\left(r(x)^2-g^2\right) K_w(r(x)-g) \frac{u_{y 0}(x)}{r(x)} u_{y 0}(x) d x
      $$

    - ❓目前的python代码没有用到接触力calculate_contact_force3d_3计算？

    - ❓目前代码calculate_contact_force3d_3的编程和想要实现的效果并不是完全一致的？

- 下一步的计划：

  - 尝试修改Matlab代码，将接触部分全部改为非线性的节点力施加在方程的右侧，看结果是否一致；
  - 尝试编写摩擦力的计算程序，并进行数值验证！



#### **230318** 节点摩擦力的计算

- Contact Model代码改写：
  - 将接触力的计算方式全部改为计算右端力的形式，也就是直接采用python代码
  - calculate_contact_force3d_3中计算接触力的方法计算完整的接触力作为方程的右端项；
  - 数值结果：
    - 线性刚度矩阵 - 利用fsolve计算出错
    - 线性刚度矩阵 - 利用fsolve计算得到与改写之前完全一致的数值结果；
- Friction Model代码编写：
  - 根据接触力计算摩擦力，只有当接触力不为0的时候才能计算得到摩擦力；
  - 计算摩擦力的方法，只需处理左侧的端点，右侧的端点处理是完全类似的，详细见Friction_model更新；





#### **230328** 摩擦均布力转换集中力

- 关于Robin提供算例的检查
  - longbeam的摩擦力算例：
    - 没有摩擦部分，提供算例是P=0的情况，只是为了检查线性模型是否工作；
    - 对于有摩擦时，提供算例的单位m应该修正为mm；
  - 检查线性模型计算的longbeam模型没有问题；
- 关于摩擦力作为分布力的计算方法
  - 离散方法求解得到的刚度矩阵Ax=f中的f指的是集中力；因此当作用的是均布力的时候，需要使用积分的方法转换成集中力，施加在节点上，但是转换的时候**某个方向的分布力会产生其他自由度的集中力**，比如z方向的均布力对z方向的挠度进行积分的时候，也会产生对转角的弯矩；
  - **接触集中力**的计算，考虑一小段粱单元，假设在此段的某一个位置的表面上发生了接触：
    - 此时直接会在表面接触点产生一个指向中心点的接触力，假设方向是$n$（在yz平面上的一个方向），将表面上的接触力平移到中心点处，由于接触力是指向中心的，因此在平移的过程中不会产生弯矩和扭矩；
    - 上述过程得到均布意义下的均布力，由于是沿着$r$方向，对其进行分解，根据发生接触点的位置，得到分解的方向向量，得到对应的$y$和$z$方向的接触力；
    - 根据分布力转换成集中力的计算公式，分别将$y$方向的均布力转换成与$y$方向挠度有关的四个自由度对应的值进行计算，类似的$z$方向的计算也是一样的；
- **摩擦集中力**的计算，考虑一小段粱单元，假设在此段的某一个位置的表面上发生了接触：
  - 此时直接会在表面接触点产生一个在垂直于接触力平面上的摩擦力，将表面上的摩擦力平移到中心点处，在平移的过程中会产生弯矩和扭矩，也需要考虑弯矩和扭矩的影响；
    - 中心点摩擦力沿着$x$方向的大小 =  接触点摩擦力沿着$x$方向的大小；
    - 中心点摩擦力沿着$y$方向的大小  = 接触点摩擦力沿着$\tau$方向的大小在$y$方向的分量；
    - 中心点摩擦力沿着$z$方向的大小  = 接触点摩擦力沿着$\tau$方向的大小在$z$方向的分量；
    - 中心点摩擦力产生$x$方向的扭矩  = 接触点摩擦力沿着$\tau$方向的大小和半径的叉乘；
    - 中心点摩擦力产生$y$方向的扭矩  = 接触点摩擦力沿着$x$方向的大小和半径的叉乘后在$y$方向的分量；
    - 中心点摩擦力产生$z$方向的扭矩  = 接触点摩擦力沿着$x$方向的大小和半径的叉乘后在$z$方向的分量；
  - 上述过程得到均布意义下的均布力，根据分布力转换成集中力的计算公式，分别将上述力和矩分别与对应的形函数乘积进行积分，将均布力转换成节点对应的集中力；





#### **230416** 线摩擦的理论和代码整理

- 空间坐标系的转换公式和分量的转换公式，见文档LineFrictionModel.pdf；
- 形函数的计算：
  - 参考单元[0,1]上的形函数是最简单的，没有涉及单元长度的；
  - 一般单元$[x_{i},x_{j}]$上的形函数是需要考虑单元长度的，主要是由于现在考虑的是Hermite单元，而不仅仅是Lagrange单元，注意区别！！
  - 实际上，计算中采用的形函数都是在一般单元上考虑的，此时的$\xi=\xi(x)=(x-x_{i})/(x_{j}-x_{i})$，因此在一般单元上的形函数关于$x$求导的时候，可以看成是关于$\xi$求导再乘以$1/l$；
- 接触力方向的考虑：
  - 接触力的方向是和位移的方向是相反的！！！
  - 摩擦力的方向是和速度的方向是相反的！！！
  - 中心点摩擦力产生$\tau$方向的扭矩是与$\tau$的方向是相反的！！！（假设接触力沿$x$轴正方向的话）
- TODO：可以考虑点摩擦模型不同速度的计算过程：
  - 之前表面各点处的速度都是相同的值，利用中心线上的速度求解得到；
  - 可以使用速度的计算公式，将两个端点的速度代入计算公式，可求解两个端点对应表面节点的速度，这里需要用到的是：
    - 根据两个端节点的位移计算出对应的接触力，得到接触点的坐标；
    - 根据接触点的坐标计算代入表面速度的计算公式得到对应的接触点速度；



#### **230516** 线摩擦代码和PPT整理

- Matlab：增加点摩擦模型的代码
  - OLD： 在Para中增加接触表面速度计算的参数，但是只能适用于所有节点速度相同的情况；
  - NEW：根据节点处的速度，利用公式可以直接计算出节点yz平面上接触点的速度，只需要根据位移计算得到接触点的坐标S，再代入到计算公式即可；
- Matlab：增加测试算例test0517
  - 主要是增加了输出部分的参数，包括了参数设置，计算设置，和相应的输出；
  - 增加了不同的测试算例，主要是8个测试用例；
- PPT0517版本：
  - 增加了整个计算流程的回顾；
  - 增加了线接触模型和点接触模型的计算流程图方便理解；
  - 增加程序说明图；
- 测试算例两个并且得到合理的结果：
  - classicalBeam + 非线性模型 + 相同的节点速度
  - longBeam + 线性模型 + 不同的节点速度
