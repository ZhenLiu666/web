### BeFEM_Meeting

> Copyright ZhenLiu
>
> 2023/10/11
>
> Meeting record for BeFEM regular discussion, mainly contains Todo, Done, New things etc.



##### Notaion 

| Mark               | Meaning   | Scene |
| ------------------ | --------- | ----- |
| :white_check_mark: | Done      |       |
| :pushpin:          | TODO      |       |
| :star:             | Important |       |
| ❓                  | Question  |       |
| ⚠️                  | Warning   |       |



#### 2023.10 Meeting 



##### 2023/10/11  Regular Meeting  

- ❓【Preconditioner for RM plate model 】
  - Arnold,  RM plate,  Mixed form 
  - Arnold,  MITC4 ? 
  - what's the mixed form? 
- ❓【Domain Decomposition】
  - 许学军，张上游老师的DDM算法
- Supplement
  - How to realize MITC3,  MITC4, MITC9, MITC8 element 
  - 伟哥计算桥模型，拱的话用lagrange元，座基用胡张元
  - 数据与弹性模量相比，如果比较小的话，就直接置0
  - 刚度矩阵不对称的话如何处理？可能由耦合引起的只有几项是不对称的，因此需要解决这个问题呢？
- 小组分工

| 小组           | 组长   | 副组长 | 组员           |
| -------------- | ------ | ------ | -------------- |
| 胡张元算法     | 马睿   | 陈伟   |                |
| 求解器—直接法  | 龚老师 | 韩豪   | 张雯倩         |
| 求解器—迭代法  | 吴老师 | 李佳音 | 刁旭昊，詹雨桐 |
| 非结构单元开发 | 龚老师 | 刘震   | 杜欣远，陈晓倩 |
| AI算法         | 胡老师 | 金鹏展 |                |





##### **2023/10/16  Multigrid**  **吴金彪**

- 几何多重网格

- - 给定几何点坐标

  - 给定矩阵$A_h X_h=F$，其中$X_h$对应的是自由度，可以得到残差满足的方程$A_h e = g$

  - 如何构造粗网格，在原来的网格尺寸下划分更粗的网格（可以是比较规则的长方形的网格），但是对粗网格的尺寸有要求

  - 构造拉伸算子 $A_H = (I^{h}_{H})^{T} A_{H} I^{h}_{H}$

  - - 在每个矩形块中，如果细网格对应节点落在区域中就是系数为1，否则系数为0
    - 利用粗网格上的双线性函数，在粗网格的节点i为1，在节点j的值为0，对应一个基函数，利用此给出对应细网格节点的值

  - 在粗网格上求解 $(I^{H}_{h})^{T}A_{h}I^{h}_{H} e = (I^{H}_{h})^{T}g $

  - 光滑子的方法

    - Gauss-Sediel迭代
    - 块Gauss-Sediel迭代
    - 重叠型的区域分解算法（从理论上能保证收敛性，代价就是运算量变大）

- 需要注意的是：
  - 线弹性方程组中的位移有3个分量，在求解的时候最好是解耦，也就是粗网格的$u_x$和细网格的$u_x$对应
  - 计算Gauss-Sediel迭代的时候，可以考虑将粗网格中的所有节点构成的块统一进行求逆，求完逆矩阵之后可以反复使用来进行磨光
  - 可以考虑使用并行的算法来计算Gauss-Sediel法



##### **2023/10/18 Multigrid 张雯倩**

- :star: 粗网格的选取范围和网格尺寸的选取

- - 二维的划分，确定左上右下角的范围，划分成方格
  - 不一定是正方形，不一定全是一样的网格尺寸，可以在x和y的方向采用不同大小的尺寸
  - 第一层的粗网格的划分可以先划分一次，检查每个粗网格单元中的细网格节点数，如果超过某一个阈值，需要再进行局部的加密
  - 后续可以考虑系数相差比较大的，或者有界面问题，局部加密问题等所对应的粗网格划分方法

- 网格节点排序和重排

- - 排序第一层粗网格的顺序，因为第一层是方方正正的，并且极大的减少了必要的网格节点数目，因此只对第一层重排即可；
  - :pushpin: 【重排算法】根据CSR格式设计必要的重排算法，需要的输入是节点的坐标，节点旧自由度的排序，节点新自由度的排序，矩阵A，需要输出的是排序后的A

- :star: 拉伸算子

- - 一般来说，粗网格上的基函数是细网格的基函数的组合！
  - 只有嵌套的网格，才能使得上述组合是严格成立的，对于不嵌套的网格，只能使得上述是近似成立的
  - 最简单的拉伸算子：取值为0或1，如果在粗网格方框内就是1，不在粗网格方框内就是0！

- :pushpin: 块磨光

- - 假设考虑的是3维的线弹性方程，每个方向上粗网格的节点包含3个细网格的节点，总的自由度是3^3*3=81个自由度
  - 块磨光需要在每一块上计算一个逆矩阵
  - 需要提前存储节点的对应的信息，以及拉伸算子，先把这些先验信息计算完成，然后再计算实现

- 在美国区域分解比多重网格更流行一些，重叠型的区域分解可以考虑



##### **2023/10/18 Regular Meeting**

- MITC4插值单元
  - 混合张量型的插值，需要将应变的几个分量分开进行考虑计算
  - 三角形的单元计算更复杂，需要保证各向同性，需要对三角形的斜边上的应变进行假设；
  - 看一下能不能算壳的结果，壳的变形比较小的时候，曲面弯曲比较小的时候是可以使用的；
  - :pushpin: MITC4是三维的结果，但是一般的壳元只能得到2维的结果，再计算三维的结果，因此再进行比较；
- 坦克模型
  - :pushpin: 柔性单元的实现
  - :pushpin: 六面体/五面体单元的实现，需要实现Jocobi变换，单元比较复杂的时候计算错误？
- 接触模型
  - herz接触模型，比较简单情况的接触有解析的解答，可以和有限元模型的解答进行double-check
  - :pushpin: 接触模型有限元单元的计算分析，需要考虑如何进行编程实现？



##### **2023/10/23 BeFEM软件安装**

- 将软件安装包直接打开，安装到D盘会自动生成BeFEM的文件夹
- :smile: 修改Matlab运行的方法：
  - 找到Matlab的安装路径；
  - 运用记事本打开，修改BeFEM/plugins/scripts/start_matlab.mat的第12行
- 注意：必须在安装路径下双击打开BeFEM！才能有效调用Matlab求解器，调用的时候不需要提前打开求解器
- 选择算例： 打开/Examples/， 第一个是车架，最后一个是可以计算的
- 显示结果：后处理/显示结果/计算云图
- :smile: 使用技巧：
  - 可以直接在BeFEM/plugins/scripts/中找到需要计算用到的A和b
  - 可以点击 BeFEM.log文件，实时查看程序运行的状态，比窗口中的结果更加详细
  - 打开任务管理器，点击进程中的详细信息，可以查看正在运行的进程



##### **2023/10/23 接触模型**

- 接触问题的初始状态：
  - 静力学分析中： 预先计算一次，判断是否发生接触，然后再逐步的计算分析
  - 动力学分析中： 可以多次调整时间步，判断是否发生接触
  - 不一定是完全发生的接触，可以设置接触判别的**阈值**
- 【可编程计算】接触点对的判断方法：
  - 给定接触从面上的一个点A，找到离该点距离最近的点B
  - 找到点B所在的四个平面，确定该点A在此平面上的投影是在平面内还是平面外
- ❓ 接触模型分析的整体流程具体是什么？ 有没有收敛性的理论结果？
- 参考《王勖成-有限单元法》中的接触问题
- :warning: SLB思考的启发：
  - 将低次单元的计算结果推广到高次单元进行相同的分析，利用形函数计算刚度；
  - 考虑平滑过渡接触模型，这样能使迭代法的收敛性得到保证！



##### **2023/10/25 Multigrid张雯倩**

- C++编程的思路

  ```Matlab
  MGOpearator(Ac,node,node-rank, dimension, node-dof, levels, dynamics)
  // Ac - the matrix A on the course grid
  // node - (x1,y1,z1,x2,y2,z2,...,xN,yN,zN) 
  // dimension = 2 or 3,   node-dof = dof of a node
  // dymamics = True, then levels = log(m*n)
  // levels 网格嵌套的层数
  
  meshsplit(node_info, dimension, node-rank, node2mesh, mesh-count)
  // node2mesh - 存储每个细网格的节点应该在哪个粗网格中，需要考虑去除没有细网格的粗网格操作
  // 粗网格设置成细网格的每个小块中的中心点的位置，不需要用加权平均的方法进行计算
  ```

- 关于$P$的计算

  - $P^T A_c P u = P^T F$ ，注意这里的$F$应该是残差的部分
  - $P^{T}$是从细网格到粗网格的映射，如果细网格节点在粗网格中，就应该设置成1
    - 一般差分法会要求系数的求和等于1，但是有限元方法分析中一般不需要加这个条件
    - 看成是基函数去找$P^T$的值应该怎么，此时粗网格的节点对应的基函数，基本上是可以看成在几个细网格节点的连接处取值为1，其他地方取值为0的一个函数
  - $P$是从粗网格到细网格的映射

- 关于重排的想法（并行化），调研块GS迭代，染色的方式进行并行计算

- 关于输入信息

  - 需要增加节点和自由度之前的关系node2dof，方便重排算法
  - 目前已知的信息是elem2dof，看如何进行转化？



**2023/10/25 Regular Meeting**

- 直接法求解大规模稀疏矩阵的加速方法：
  - 重排算法，逆序算法
  - 考虑零元素的位置，在分解的时候进行考虑
  - 利用稀疏矩阵的特点进行符号分解，预先确定非零元的位置，确定存储大小
  - :smile: 快速直接解法的关键是确定分解的路径！ 填充元算法！
  - 常见的软件： UMFPack, SuperLU, NUMPS, PARDISO
  - 考虑用共轭梯度法计算
    - 迭代的步数最多是n步，用稀疏矩阵的非零元估计总的计算量
    - 矩阵比较差的情况下，矩阵向量乘法的计算量
- 参考陈龙老师的CG方法进行实现





**2023/10/27 Meeting**

|        | 优点                                                         | 不足                                                         | 评分5 |
| ------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ----- |
| 娄能闯 | 工程侧项目经验比较丰富；学过断裂疲劳；有过软件开发经验；**力学相关课程还算比较扎实**； | 理论基础匮乏，不了解混合元，线性方程组原理，大部分偏向应用软件而不是算法； | 4     |
| 王钦   | 10W规模自由度10s求解，有一定的**理论分析基础**，了解大规模方程组的一些特点和一些常用的方法 | 有限元理论几乎为0，没有做过工程的算例，没有实现过GMERS等算法，不了解多重网格，针对直接法的求解基础也不是很扎实 | 3     |
| 李世杰 | 态度很好，工程经验丰富                                       | 问的问题没有一个答上来的，感觉更像是**算法应用工程师**，而不是开发工程师 | 3     |
| 胡博   | 表达清晰，有机器学习深度学习基础，但是掌握的不是很深         | 和我们的项目契合度不高                                       | 2     |



#### 2023.11 Meeting



##### **2023/11/01 Multigrid 张雯倩**

- 并行块G-S染色排序的算法
  - 根据节点信息，采用set或者二叉树等方法，生成图结构矩阵，图中的非零元素表示两个节点是相关联的，如果是有向图的话，对应的结构矩阵可能是非对称的；
  - 采用贪心算法进行着色，颜色相同的部分为一块；
  - 使用并行G-S迭代进行算法在每块颜色相同的区域进行计算；
- 并行块G-S迭代算法
  - 直接根据位置信息划分求解块，有可能信息有重叠；
  - 在每个块内部，直接对块内部的矩阵进行求逆（GS迭代），包括块内部的元素和其所有的自由度；
  - 不相邻的块可以进行染色，然后采用并行的方法进行着色；
  - 二维的情况可能会有4个颜色，三维的情况可能有9个颜色；
- 待做事项
  - 考虑没有节点在多个块的情况进行划分并串行求解；
  - 排序的时候，不改变A，创立一个新的矩阵A‘；



##### 2023/11/01  Regular Meeting

- 【完成】接触判断算法和代码的实现，主要是点和面的判断；
- 【待做】制定一个非结构单元的完成进展计划



##### 2023/11/03  禅道更新和系统构建

- 关于自动构建
  - repository - 配置 - web
    - http://162.105.114.85:8080/generic-webhook-trigger/invoke
    - befem#befem-solver-hz
  - 在每个文件夹下面加入ci文件夹，更改里面的文件夹的编号ip

- 禅道系统的命名
  - 命名的方式：
    - ST - Solver Theory  随用随写
    - F - Front   前端
    - S - Solver 求解需求
    - M - Manager 非研发需求，UI，文超，佳雯
  - 关于填写：在每个月的月初，填写禅道的任务在ST中，填写开始时间和预估结束时间，假设每天的时间是4小时，每个月的工作是21天，那么就是实际工作是84小时的工作量；
  - 管理方式方式
    - 按照需求进行任务的开发，提前规划类的任务开发；
    - 如果临时有事情做完的话，及时填入任务进度，这是临时任务的管理方式；
- 面试 - 代新尧
  - 邢誉峰 - 计算位移的有限元方法不太好，混合元计算应力精度更高；
  - 晶体优化算法中的结构都是板的结构，很少用到壳的结构；
  - 目前可做的几个研究内容：
    - 大规模系数矩阵的存储和求解，包括直接法和迭代法的调研；
    - 关于非结构体单元的实现，主要是壳单元的开发，目前没有开发Mindlin板的经验；
    - 胡张元算法，debug三维胡张元相关；
    - 前端求解器的开发，主要是ansys和abaqus相关的任务实现；
    - 算法和算例测试，完成某些前端功能的实现，并提出新的需求，用户角度的实现方法；
- 产品研发规划
  - 杜欣远： 
    - 三角形壳3个，MITC3，MITC6两个类型
    - 五面体单元，三棱柱和金字塔模型
    - 弹簧单元，质量单元的实现
  - 刘震：
    - 接触模型理论的调研，构建解析的解答，使用高阶单元进行实现
    - 壳单元的理论和研发
    - 两个专利的书写



##### **2023/11/04 接触混合元 杜欣远**

- 本文的创新是使用最小二乘方法分析接触问题，将互补条件加入泛函进行考虑！（之前是强制使得这个条件成立，在约束中体现，现在直接在泛函中进行考虑） 这样在误差分析的时候会有一定的影响但是影响不大，由于只会在发生接触的单元上发生这一现象，可以采用调整参数避免，但是在数值分析的时候发现不进行调整对结果的影响也不是很大。有限元离散： 位移用P1元，应力用RT元（不需要对称性条件）；
- :pushpin: 问题
  - 有限元解是否满足互补条件？
  - 在理论上会掉阶，但是在计算的时候没有，是不是说明理论分析做的不够准确？
  - 证明不等式的时候，只需要说明右边=0，能推出左边=0就可以吗？
  - 式子2.9的成立是什么含义？涉及到了非常弱的范数在一部分的边界上的定义？
  - semi-smooth Newton, active set strategy求解约束变分不等式？
  - 式子3.7的估计需要再看一下？
  - 从数值算例来看，互补条件并不是一个被连续满足的条件，因为三维的例子图片中，被染色的部分是没有规律的，并不是连续的；
  - ❓可以从原始问题，或者混合问题出发，最小二乘只是其中的一种方法。可以使用位移法只对位移进行约束，使用应力法只对应力进行约束
- 整理
  - Korn's inequality + Poincare inequality 
  - 一些关于应力的估计
  - 自适应的一般思路和相应的过程
- ⚠️考虑胡张元实现接触问题，但是由于是高次元，因此只在顶点满足互补条件，并不能使得整个单元的边上都满足，但是是可以计算的，只是分析上是比较困难的。
- ⚠️在计算接触的时候，对于接触条件$un-g=0$，接触力为0的情况，在计算的时候有可能会计算得到接触力不为0，从而将实质没有接触的情况按照接触计算，浪费计算效率，尤其在网格较粗时影响结果。



##### **2023/11/08 Multigrid 张雯倩**

- 佳音师姐： Fasp, 张晨松老师，中科院主页，要实现一个缩小的多重网格包
- 对矩阵进行排序的时候，可以不用构建新的地址存储排序后的矩阵
  - 只需要构造一个对应的关系，比如node2mesh，可以写成2维的矩阵，每一行对应的是每一个粗网格对应的细网格节点的节点数目；
  - 在进行GS迭代的时候，需要对块进行更新，每一块对应的是每一个粗网格块，按照块的排序进行迭代更新，需要注意的是在每个块内的节点有多个自由度；
- 迭代法验证解答的正确性
  - 迭代法的收敛准则：比较相邻两次迭代的误差并不能保证迭代法收敛到正确的结果；
  - 迭代法的收敛准则：比较迭代法的残差，$\|Ax-b\|$的范数
  - 或者与Matlab的解答，进行比较$L^2$范数的误差



##### **2023/11/08 Lag-Hu混合求解**

- 混合求解的一般思路：
  - 将区域分解成两部分，一部分用经典的位移解法，一部分用混合元方法，再加上连接处的条件$u_1=u_2, \sigma_1 n_1 = \sigma_2 n_2$，最后对总的线性方程组进行统一的求解。需要注意使用的单元阶次应该匹配。
  - 混合求解的目的是想在需要的地方进行高精度计算，因此两个区域的交界面是可以自由选择的，尽可能选择简单的界面利于计算；当需要使用Lagrange等参元的时候必须用等参元，其余地方可以用胡张元。
  - 先申请专利，再写文章，最后再程序中进行实现。
- 写工作的时候，要突出意义，说清楚问题的背景，别人的工作，才知道自己的工作的意义。



**2023/11/11 二维胡张元 杜欣远**

- :star: bubble function的理解，其实是和trace有关系的
  - $H^1$的bubble函数就是在边界上是0，对于三次Lagrange函数可以得到$\lambda_1\lambda_2\lambda_3$是泡函数
  - $H(div)$的bubble函数就是其法向分量是0，胡张元的在边上的切向切向基的基函数就是泡函数
  - 给出泡函数的表达式是比较困难的？创造性给出泡函数
- :star: 关于空间的构造理解：由于采用了$P_{k-1}$次的间断函数空间，因此需要将原来的空间扩大，将$H^1$添加一些bubble函数空间，从而使得给定$v_h$之后，能找到合适的$\sigma_h$
- 关于三维的正则复形
  - 线弹性复形 $H^1 \rightarrow H(\operatorname{curl}) \rightarrow H(\operatorname{div}) \rightarrow L^2$
  - Stokes复形 $H^3 \rightarrow H^2 \rightarrow H^1 \rightarrow L^2$
  - Arigs弹性复形 $H^2(P_{k+2}) \rightarrow H(\operatorname{div})(P_k) \rightarrow L^2(P_{k-1})$ 第一个箭头对应的是Arigs算子
  - Stokes复形相当于在线弹性复形的基础上将空间的正则性进行了提升
  - 从而可以推出 $H^1 \rightarrow L^2$是一个满射？ 借助复形可以给出结论
- $\operatorname{div} \Sigma_{K,b} = V_{K,\perp}$的一种证明方法就是，由于前者一定是在后者的空间中，因此只需要说明两者的维数是一致的，注意到⚠️bubble函数的散度为0的空间一定是Airy函数对应。是否可以通过复形印证❓求散度以后不为0的部分一定是线性无关的吗？
- 胡老师的二维线弹性的文章本质上构造一个不是通常意义下的Fortrin插值算子。如果要想得到$\sigma$的$L^2$误差估计，就得需要用到这个算子才能证明
- 非椭圆算子的分析方法：
  - 证明infsup条件；
  - 可以使用某些紧性进行控制$H^1$嵌入$L^2$空间中；

- 问题
  - 师姐说的要定义插值在积分下有意义，必须使得函数在$H^1$中有意义？
  - 为什么要满足算子的可交换性？为啥说也可以定义别的投影，就不用$H^1$了？
  - $\operatorname{div} \Sigma_{K,b} = V_{K,\perp}$ 泡函数空间的散度正好等于RigidMotion的垂直补空间！有没有什么物理含义？
  - 在每个单元上可以唯一确定的优势是什么？
  - 复形的离散版本比连续的情况难证明，因为离散版本虽然在每个单元上都是成立的，但是由于需要满足一些连续性的条件，因此也不好实现
  - 本质上胡老师的二维的元相对于Arnold的元，就是Arnold元利用节点进行插值，但是胡老师的用低一次的多项式进行插值，发现不够，补充了泡函数空间。



**2023/11/20 Multigrid 张雯倩**

- 矩阵的行列变换，需要变换x，然后进行V-cycle进行计算，计算完成之后再将x进行变换回去
  - 每个对角块的大小就是每个最细网格块包含多少个较粗网格的节点个数
  - 有多少个粗网格的块大小，就有多少个重拍后的矩阵块
- 关于块G-S迭代的方法
  - 假设重拍后的矩阵的对角块矩阵为D，其余的部分是D',也就是A=D+D'
  - 对应的可以得到$x^{k+1} = D^{-1}(-D'x^k + b)$
  - 需要注意的是如果在第一块的矩阵和最后一块的元素没有相交的基函数，那么就可以并行的更新，当然如果不考虑效率可以直接进行并行，但是没有使用sedie技巧



**2023/11/29 Multigrid 张雯倩**

-  块GS迭代的时候，V-cycle的时候在下降阶段的时候从前往后做，相当于乘以$(D-L)^{-1}$，在上升阶段的时候，从后往前做块GS迭代，相当于乘以$(D-U)^{-1}$，这样子才能保证最后总的矩阵是对称的！
- 目前的工作
  - Smooth是最重要的，因为代数多重网格很难控制其他的参数提升效率，但是Smooth最直接提升
  - 只用两层就可以的，每层的每个方向大概是1万的网格
- 重叠型的GS迭代方法
  - 原始的粗网格是不改变的
  - 只是在计算的时候，将粗网格周围一部分的点同时进行更新，即时对矩阵进行更新
  - 要关注直接法，在对矩阵进行多次分块之后，每次要用直接法求解！



**2023/12/06 Regular Meeting**

- AMG方法的粗矩阵是很难产生的；
- FastSolver张晨松老师；
- 云道制造，只能在软件内产生CAD，几何网格，不支持导入高阶的网格；
- 
