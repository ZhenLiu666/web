### 多重网格

> Copyright ZhenLiu
>
> 1901210082@pku.edu.cn
>
> 2022/08/20



#### 1 基本介绍



##### 1.1 初步了解

- 背景介绍：
  - 应用领域：多重网格法是求解由偏微分方程离散化引起的大规模线性和非线性方程组的最有效的数值方法之一；
  - 近似推广：这些类型的方法可以看作是传统的基于局部松弛的迭代方法的加速，如Gauss-Seidel和Jacobi方法；
- 几何多重网格(GMG)方法：
  - 应用领域：二阶和四阶椭圆边值问题；
  - 收敛性：对于由算法产生的线性代数系统具有一致收敛性和近似最优求解复杂度；
  - 特点：这种多级算法的一个主要组成部分是几何网格的层次，通常是通过逐次细化得到嵌套的网格序列；
  - 基本思想：
    - 对于椭圆型边值问题的有限元或有限差分离散化所产生的线性系统：
    - 局部松弛法对解的高频部分收敛速度很快；对于低频项（函数相对平滑部分）收敛较慢；
    - 低频项这部分恰恰可以很好在一个较粗网格上很好的被近似；
    - 多重网格方法思想即是将局部松弛法经过几次迭代后的误差投影到一个更粗的网格上；
    - 在粗网格上求解投影误差方程；
  - 投影误差方程有如下特点：
    - 求解系统的规模更小。
    - 在较细网格上缓慢收敛的部分低频误差在较粗网格上变得相对高频；
    - 这些频率可以通过在较粗网格上的局部松弛法进一步校正；
    - 通过在更粗的网格上重复这个过程，便得到了一个多级迭代过程；
  - 局限性：它们依赖于几何网格的层次结构，而这往往不是现成的，因此可以认为GMG方法的适用性范围有限；
- 代数多重网格(AMG)方法：
  - 发展背景：为了解决GMG方法的问题而设计的。它们被提出作为一种推广几何多重网格方法的手段；
  - 应用领域：用于与离散偏微分方程(如拉普拉斯方程)具有相同性质的方程组，但对应的离散化中可能有非结构化网格；
  - 基本过程：
    - 选择光滑子(smoother)：局部松弛迭代方法，如pointwise Jacobi或Gauss-Seidel，overlapping Schwarz methods；
    - 注意：在任何情况下，选择的光滑子只对于真解的某些部分收敛较快，这被称为给定光滑子对应的代数高频项；
    - 确定光滑子后，AMG方法的主要任务是确定一组粗糙空间序列，**作为对应光滑子**的补充；
    - 粗略的说一个理想粗空间序列应满足：在最细空间中的任何向量（即任意给定$f$方程(1.1)的解）都可以用所有粗空间上的所有代数高频的线性组合表示；
  - 收敛性：
    - 对于多层网格，很难回答这个理论上的问题；
    - 对于两层网格：给定一个光滑子R，什么是给定维数的最优粗空间，使得到的AMG具有最好的收敛速度？
      - 最优粗空间将由特征向量组成，这些特征向量对应于一个矩阵(如RA)的谱的下端；
      - AMG设计的任务是找到这个代数低频特征空间的一个好的但廉价的近似，仍然会导致一个具有理想收敛特性的AMG算法。我们把这种最优粗空间的近似称为“准最优”粗空间。
  - 基于图的优化策略：
    - 
- 本文内容：
  - 研究内容：
    - 从理论角度对AMG的设计和分析进行全面研究的任务；
    - 设法重新检查大多数现有的结果；
    - “重新发明轮子”，试图提供一个连贯的理论描述：开发了几种用于AMG设计和分析的工具；
  - 研究对象：对称半正定(SPSD)系统$Au=f \quad  (1.1)$
    - 大多数AMG算法都是针对对称正定(SPD)系统的求解，很少有例外；
    - 比如： 齐次Dirichlet边值Laplace的标准离散化产生SPD系统；
    - 线性系统的SPSD类可以被视为AMG思想的更本质的一部分；
    - 比如：具有齐次Neumann边界条件Laplace的标准离散化产生SPSD系统；
    - 上述例子中的SPD系统可以看成是SPSD系统的局部问题(定义在子域上)；



##### 1.2 内容摘要

- 符号介绍和基本框架
- 工具

5. 要把上面的多层设定转换成简明的数学表述是很困难的。相反，我们将专注于首先回答这个问题的两个层次的设置。对于两级设置，第一个理论问题是:“给定一个光滑子R，什么是给定维数的最优粗空间，使得到的AMG具有最好的收敛速度?”“这个问题将在第5部分彻底解决。正如它所证明的那样，最优粗空间将由特征向量组成，这些特征向量对应于一个矩阵(如RA)的谱的下端。虽然我们的两层理论在理论上是令人愉快的，但它并没有提供一个实际的解决方案，因为找到这些特征向量将是太昂贵了。因此，
6. 在所有这些AMG算法的设计中，一个关键组成部分是通过与矩阵a相关的图对空间进行粗化。两种主要策略是基于独立集的策略和基于聚合的策略。我们将给出构造准最优粗空间的几种方法。我们特别提倡两种具有良好理论基础的方法。第5节和之后的第11节概述了第一种方法。我们将首先证明第5节中的理论中的最优粗空间可以用数学上等价的方式，通过一个跟踪最小化问题的解来表征。在函数集中，这样的轨迹最小化可以解释为粗基函数集能量范数之和的最小化。这些精确的等价物为如何构造AMG方法提供了非常明确的指导。基于该定理的一种实用方法是在局部支持的函数类中寻找能量最小化的基函数。得到的算法被称为能量最小AMG。其他AMG方法，如经典AMG和基于聚集的AMG，可以被视为能量-min AMG的近似。第6节概述了第二种方法。其主要思想是通过拼接某些适当定义的局部算子或矩阵的低端本征空间来构造一个准最优粗空间。该方法可为各种AMG方法提供准最优粗空间，包括标准几何多重网格法、经典AMG、能量最小化AMG、非光滑和光滑聚集AMG以及谱AMGe。作为一个简单的例子，该方法依赖于一个算子的nc = Jm维低端特征空间可以通过将m维低端特征空间的j块粘合在一起来很好地逼近一些精心选择的局部算子。这里m是一个非常小的整数，例如，对于拉普拉斯算子m = 1和m = 3。M = 6)为二维(对应。三维)线性弹性算子。本征空间的这个重要性质与第2.3节讨论的关于椭圆边值问题本征值渐近行为的Weyl引理密切相关；
7. 大多数AMG方法是根据给定线性代数系统的系数矩阵的邻接图来设计的。本节给出了图论和稀疏矩阵的邻接图的简要描述。第7节的一个重点是M矩阵-reltive的概念。这个简单的工具有助于经典AMG方法的设计和分析。 
8. 大多数AMG方法的设计中，一个重要的步骤是利用连接强度的概念来构造一个滤波矩阵Ã，将系数矩阵A的一些项归零，这相当于在邻接图G(A)中省略弱连接边来得到G(Ã)。第8节介绍了几种可能的强度函数来描述连接强度。
9.  图G(Ã)通过保持最大独立集(MIS)作为粗顶点集C，然后删除网格的其余部分，或者使用聚合/聚集来粗化。在第9节中，我们还给出了利用自由度构造粗空间的一些技术细节。

- 通过使用上述的一般方法和理论技术，然后我们激励和提出了一些AMG方法。本文的一些重点概述如下。 

10. 概述GMG及其与AMG的关系：
    - 对线性有限元矩阵的典型GMG方法进行详细描述；
    - 我们认为定义GMG的几何信息本质上是底层有限元网格的图形信息(不使用网格点的坐标等其他几何信息)。这强烈地表明，至少一些GMG方法可以以纯代数的方式实现，只使用刚度矩阵、代数平滑器和刚度矩阵的邻接图。另一方面，我们证明了GMG方法也可以通过我们在第6节中提出的一般AMG方法得到。此外，我们使用第10.4节中的AMGe示例来演示网格上的几何信息可以有效地构建一个基于几何的AMG。 
11. 在第11节中，我们给出了基于能量最小化的AMG方法的详细说明。我们首先提出了我们的新理论，即第5节中两能级理论中所示的最优粗空间实际上可以通过跟踪极小化得到(第11.1节)，然后我们通过寻找一组用于能量极小化的局部支持粗基函数，推导出能量极小AMG方法。 
12. 经典的AMG算法，作为第一类AMG算法的研究，将在第12节介绍。我们利用第6节的框架和第7.2节介绍的M-矩阵关联的概念推导和分析这种类型的方法。我们进一步讨论了如何将经典AMG方法视为能量-min AMG方法的近似。 
13. 基于聚合的AMG将在第13节中介绍。我们再次使用第6节的框架推导和分析这种方法。聚合AMG方法的一个显著特点是易于保持多维近零空间，如线性弹性力学中的刚体模态。 
14. 为了演示AMG方法如何解决给定问题中可能的异质性质，我们将在第14节展示经典AMG是如何设计来解决具有强不连续跳跃或基础PDE系数各向异性的离散椭圆问题所引起的困难。 
15. 在第15节中，我们概述了一类AMG方法，试图以自举和自适应的方式选择粗空间。这类AMG算法不属于本文提出的理论框架，但它们提供了一种实用的方法，将许多现有的AMG技术推广到更一般的问题。最后在第16节作了一些结束语。



#### 7  图论和稀疏矩阵



##### 7.1 稀疏矩阵和其邻接图

- 定义：
  - 不定向的图$\mathcal{G}$ 可写成集合 $(\mathcal{V}, \mathcal{E})$=（顶点和边）
  - 假设n个点构成顶点的集合，可分别记成$\mathcal{V}=\{1, \ldots, n\}$；
  - 每一条边$e \in \mathcal{E}$可以看成顶点集合中的一对无序指标$(j,k)$；
  - 之所以考虑无向图，是因为稀疏矩阵是对称的，不对称的矩阵需要有向图；
- 基本概念：
  - 两个点邻接：存在边集合中的一条边连接；
  - 两个点间有一条道路：存在多条边集合中的边将两个点连接；
  - 道路的长度：连接过程中使用到的边的个数；
  - 连通图：任意两个点都存在一条道路连接；
  - 点的邻域：$N(i)=\{j:(i, j) \in \mathcal{E}\}$
  - 点的度数：$\quad d_{i}=|\{j:(i, j) \in \mathcal{E}\}|$
  - 两点的距离：连接两个点的所有道路中最短的长度$dist(i,j)$；
  - 图的直径：$\operatorname{diam}(\mathcal{G})=\max _{(i, j) \in \mathcal{E}} \operatorname{dist}(i, j)$；
  - 独立集：任意两个点都不邻接的点的集合；
  - 最大独立集：如果再添加任意一个点都将使此独立集至少包含一条边；
- 联系：
  - 给定一个对称矩阵$A \in \mathbb{R}^{n \times n}$，可以画图其不定向的邻接图：$\mathcal{E}=\left\{(j, k): a_{j k} \neq 0\right\}$；
  - 矩阵A不可约等价于其对应的无向图是连通的；
- 稀疏性：
  - 给定$S \subset\{1, \ldots, n\} \times\{1, \ldots, m\}$，定义$\mathbb{R}_{S}^{n \times m}=\left\{X=\left(x_{i j}\right) \in \mathbb{R}^{n \times m}: x_{i j}=0\right.$ if $\left.(i, j) \notin S\right\}$；
  - 称$X$在给定$S$下具有稀疏性当且仅当$X \in \mathbb{R}_{S}^{n \times m}$，实际上$X$中只有指标在$S$中的元素才是非零元；
  - 通常给定一个$S$就能确定$X$，但是给定$Y\in \mathbb{R}^{n \times m}$，也可以定义$\mathrm{S}(Y)=\left\{(i, j): y_{i j} \neq 0\right\}$；
- 微分方程，有限元空间，矩阵
  - 假设考虑二阶Poisson方程，给定Neumann边值$\alpha \nabla u \cdot \boldsymbol{n}=0 \quad$ on $\partial \Omega$，对应的有限元空间记成$V_{h}^{N}$；
  - 假设考虑二阶Poisson方程，给定Dirichlet边值$u=0 \quad$ on $\partial \Omega_{D}$，对应的有限元空间记成$V_{h}$；
  - 注意不是0边值的问题可以化成0边值问题求解，则有关系式：$V_{h}=V_{h}^{D} \subset V_{h}^{N}$成立；
  - 假设$A^{N}$为Neumann边值问题对应的矩阵：$\left(A^{\mathcal{N}} u, v\right)=\sum_{e \in \mathcal{E}} \omega_{e} \delta_{e} u \delta_{e} v$
    - **QUE**怎么推导出来的？
    - 上述求和是$A^{N}$对应的图中所有边上的求和$\mathcal{G}\left(A^{\mathcal{N}}\right)=(\mathcal{V}, \mathcal{E})$；
    - $\delta_{e} v=v_{i}-v_{j} ，\mathcal{E} \ni e=(i, j), i<j$
    - $\omega_{e}=-\left(A^{\mathcal{N}}\right)_{i j}$是$A^{N}$非对角线的部分；
    - 从上述表达式可得，如果给定$u_{i}=1,\forall i$，代入表达式求解，表明其为Neumann问题的解；
  - 对应于Dirichlet问题由上述空间的包含关系，可得：$(A u, v)=\sum_{e \in \mathcal{E}} \omega_{e} \delta_{e} u \delta_{e} v, \quad u_{j}=v_{j}=0 \quad x_{j} \in \Gamma_{D}$
  - 自然(Neumann)边界条件微分问题与本质(Dirichlet)边界条件微分问题的相似关系不仅存在于本文所考虑的模型问题，而且存在于H(curl)、H(div)、线性弹性等问题。



##### 7.2 有限元刚度矩阵相关的M矩阵

- AMG算法常常将矩阵A的元素进行简单的处理得到一个性质比较好的矩阵，再利用此矩阵构造AMG算法中关键的组成元素，这个矩阵就是可以矩阵A得到的M矩阵；
- 一个对称矩阵$A \in \mathbb{R}^{n \times n}$称为是M矩阵，如果满足如下性质：
  - $a_{i i}>0 \text { for } i=1, \ldots, n$；
  - $a_{i j} \leq 0 \text { for } i \neq j, \quad i, j=1, \ldots, n$；
  - $A$ 是半定的；
- 称$\widetilde{A}$是矩阵A的M-matrix relative：
  - $\widetilde{A}$是M矩阵；
  - $(v, v)_{\widetilde{A}} \lesssim(v, v)_{A}$，for all $v \in V$
  - $(v, v)_{D} \lesssim(v, v)_{\widetilde{D}}, \quad$ for all $v \in V$，其中 $\widetilde{D}$ 和 $D$ 分别是 $\widetilde{A}$ 和 $A$ 的对角部分；
  - 几点说明：
    - 第一个要求中用m -矩阵来表示半定矩阵，这不是精确的定义。然而，使用m矩阵要方便得多，所以我们决定在此放宽定义；
    - 上述定义的M-matrix relative将会在粗空间的定义和收敛速度估计中发光发热；
    - 实际上第二条和第三条性质要求谱等价；

> 引理 7.3.  Let $A_{+}$be an $M$-matrix relative of $A$ and let $D$ and $D_{+}$be the diagonal matrices of $A$ and $A_{+}$, respectively. If $V_{c} \subset V$ is a subspace, then the estimate $\left\|u-u_{c}\right\|_{D}^{2} \lesssim\|u\|_{A}^{2}$     (7.10)
>
> holds for some $u_{c} \in V_{c}$, given the estimate：$\left\|u-u_{c}\right\|_{D_{+}}^{2} \lesssim\|u\|_{A_{+}}^{2}$  (7.11)
>
> 因此给定矩阵A的M-relative之后，证明(7.10)的问题只需要证明(7.11)成立即可！

- 在本章之后的分析中统一采用下述假设（假设采用线性单元）：
  - 区域$\Omega$采用单纯形划分为：$\Omega=\cup_{T \in \mathcal{T}_{h}} T$；
  - 系数$a(x)$是一个标量值函数，它在分划的$\mathcal{T}_{h}$边界上可能会不连续；
  - 根据上述符号，对于Neumann边值有：$\int_{\Omega} a(x) \nabla v \cdot \nabla u=\sum_{(i, j) \in \mathcal{E}}\left(-a_{i j}\right) \delta_{e} u \delta_{e} v=\sum_{e \in \mathcal{E}} \omega_{e} \delta_{e} u \delta_{e} v$；
  - 实际上，求解得到：$\omega_{e}=-\left(\phi_{j}, \phi_{i}\right)_{A}=\sum_{T \supset e} \omega_{e, T}$
    - **QUE**
      - 这里的$d$只能取大于等于2吗？ 0维空间的点的面积啥意思？
      - 为什么$w_{e}$本来两个基函数相关，为啥和包含这个边的所有单元都有关系？
      - 如果只是几何关系的话，和单元的面积没关系吗？
    - $\omega_{e, T}=\frac{1}{d(d-1)} \bar{a}_{T}\left|\kappa_{e, T}\right| \cot \alpha_{e, T}, \quad \bar{a}_{T}=\frac{1}{|T|} \int_{T} a(x) \mathrm{d} x$；
    - $e=(i,j)$是给定的边，两边的点分别是$x_{i},x_{j}$;
    - $T$是所有包含边的单元的集合；
    - $\left|\kappa_{e, T}\right|$是在单元$T$中与$e$相对的$(d-2)$单纯形的面积；
    - $\alpha_{e, T}$是$T$中不包含$e$的两个面的二面角；
  - 假设$\mathcal{E}$是所有边的集合，$\mathcal{E}^{-}$是所有$a_{i j} \geq 0, i \neq j$的边集合，其补集为：$\mathcal{E}^{+}=\mathcal{E} \backslash \mathcal{E}^{-}$，那么有如下表达：
  - $\int_{\Omega} a(x) \nabla v \cdot \nabla u=\sum_{e \in \mathcal{E}^{+}} \omega_{e} \delta_{e} u \delta_{e} v-\sum_{e \in \mathcal{E}^{-}}\left|\omega_{e}\right| \delta_{e} u \delta_{e} v$
  - 假定当$\Omega$是连通的（或者$\Omega$是区域）时，分划应使得常数函数是双线性形式零空间中唯一的函数；
- 结论：
  - 定义$\left(A u, v\right)=\int_{\Omega} a(x) \nabla v \cdot \nabla u=\sum_{e \in \mathcal{E}^{+}} \omega_{e} \delta_{e} u \delta_{e} v-\sum_{e \in \mathcal{E}^{-}}\left|\omega_{e}\right| \delta_{e} u \delta_{e} v$；
  - 定义$\left(A_{+} u, v\right)=\sum_{e \in \mathcal{E}^{+}} \omega_{e}\left(u_{i}-u_{j}\right)\left(v_{i}-v_{j}\right)$；
  - 实际上$A_{+}$可以通过将$A$的非对角线上的非负数加到对角线上，并将这些位置的值改为0得到；
  - 定理7.4: 假设$A$是Poisson方程Neumann边值问题的线性化离散，那么$A_{+}$是$A$的M-matrix relative，并且和$A$是谱等价的，等价关系中的常数只和网格shape-regularity的常数有关，并且$A_{+}$的图是连通的；
  - 实际上$\mathcal{E}^{-}$并不总是空集，此时可以通过构造谱等价的$A_{+}$，就可以在表达式中移除包含$\mathcal{E}^{-}$的项；
  - 引理7.5:上述记号下，$D$和$D_{+}$也是谱等价的：$[D]_{j}=\left(\phi_{j}, \phi_{j}\right)_{A} \equiv\left(\phi_{j}, \phi_{j}\right)_{A_{+}}=\left[D_{+}\right]_{j}$；
- 总结： 
  - 引理7.3将对$A$的分析转换成对$A_{+}$的分析，定理7.4给出一种构造$A_{+}$的方法思路；
  - 上述给出的例子并不够充分，在Neumann边值条件下给出的。一个典型的例子是一个矩阵，它被重新缩放了，常数不再在离散算子的核中。在这种情况下，标准的AMG应用程序可能会失败，需要通过不同的方法来恢复近核。





#### 8  连接强度

> AMG的核心任务是获得适当的粗空间，这个过程被称为粗化过程。在几何网格中，或者更一般地说，在刚度矩阵的邻接图中，我们需要确定要从图中删除的点。我们需要粗化的图来为代数上的低频率(low-frequencies)提供一个很好的近似。

##### 8.1 基本想法和强度函数

- 如果顶点的子集上有一个代数平滑的向量，比如v，变化非常慢，我们只需要保持一个自由度来表示这个子集中的v。换句话说，我们可以将这个子集聚合在一起，也可以保留一个顶点，然后删除这个子集中的其他顶点。我们说这个子集中的顶点是强连接的。连接强度是用来识别强连接的顶点对的概念。粗略地说，如果vi≈vj，我们说i和j是强连接的。
- 我们设想将图粗化分为两个阶段:第一步是删除一些边，第二步是删除一些顶点。第二步是目标。让我们来看看第二步是如何实现的:我们要么(i)将一些相邻的顶点聚集在一起，要么(ii)在过滤后的图中选择一个最大的独立集，用C表示，然后移除所有剩余的顶点。使用上面的论证，(i)每个聚合应该只包含强连接的顶点，或(ii)每个被删除的顶点应该与c中的某个点强连接。为了保证这两种情况中的任何一种，我们必须在第一步移除所有弱连接的边；
- 



